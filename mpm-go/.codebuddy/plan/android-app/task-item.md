# MPM Android 应用实施计划

## 第一阶段：项目基础架构（P0 - MVP准备）

- [ ] 1. 初始化项目结构和核心配置
   - 创建多模块Android项目（app、core-network、core-data、core-ui、core-common）
   - 配置Gradle依赖（Kotlin、Compose、Hilt、Retrofit、Coil、Room、DataStore）
   - 设置Material Design 3主题和动态配色
   - 配置代码规范和Git版本控制
   - _需求：技术架构说明_

- [ ] 2. 实现网络层基础架构
   - 创建Retrofit实例和OkHttp配置（拦截器、超时设置）
   - 实现API接口定义（ApiService）
   - 实现认证拦截器（自动添加Signature和Account Header）
   - 实现网络错误处理和统一响应封装
   - 编写网络层单元测试
   - _需求：1.5、非功能性需求-安全性_

- [ ] 3. 实现本地存储层
   - 使用DataStore实现用户认证信息加密存储（EncryptedSharedPreferences）
   - 使用DataStore实现应用配置存储（服务器地址、图片质量、主题等）
   - 创建Repository基类和数据流管理
   - _需求：1.3、12.2、12.3_

---

## 第二阶段：用户认证模块（P0 - MVP核心）

- [ ] 4. 实现登录功能
   - 创建LoginScreen UI（账号密码输入框、登录按钮）
   - 实现LoginViewModel（状态管理、表单验证）
   - 实现AuthRepository（调用/api/checkPassword接口）
   - 实现登录成功后的凭证存储和主界面跳转
   - 实现登录失败的错误提示
   - _需求：1.1、1.2、1.3、1.4_

- [ ] 5. 实现自动登录和登出功能
   - 实现应用启动时的自动登录逻辑（检查本地凭证）
   - 实现登出功能（清除本地凭证、返回登录页）
   - 实现认证失败自动跳转登录页（401响应处理）
   - _需求：1.6、1.7、1.8_

---

## 第三阶段：照片浏览核心功能（P0 - MVP核心）

- [ ] 6. 实现照片列表展示
   - 创建PhotosScreen UI（网格布局、LazyVerticalGrid）
   - 实现PhotosViewModel（分页加载、状态管理）
   - 实现PhotoRepository（调用/api/getPics接口）
   - 使用Coil实现图片加载和缓存（通过/cos/接口）
   - 实现下拉刷新和上拉加载更多
   - 实现加载状态指示器
   - _需求：2.1、2.2、2.3、2.4、2.9_

- [ ] 7. 实现照片详情页
   - 创建PhotoDetailScreen UI（全屏图片展示、Pager支持左右滑动）
   - 实现图片缩放和手势操作（双击、捏合）
   - 实现照片旋转角度自动应用
   - 显示照片基本信息（日期、位置、尺寸等）
   - _需求：2.5、2.6、2.7、2.8、4.1_

---

## 第四阶段：照片编辑和回收站（P0 - MVP核心）

- [ ] 8. 实现照片基础编辑功能
   - 实现收藏功能（调用/api/updateImage接口，乐观更新UI）
   - 实现旋转功能（90度递增，调用/api/updateImage接口）
   - 实现标签编辑（显示标签编辑对话框，支持添加删除）
   - 实现拍摄日期编辑（日期时间选择器）
   - _需求：4.2、4.3、4.6、4.7、4.8、4.9_

- [ ] 9. 实现回收站管理
   - 实现照片多选模式（长按进入多选）
   - 实现删除照片功能（调用/api/trashPhotos接口）
   - 创建TrashScreen UI（显示回收站照片）
   - 实现恢复照片功能（调用/api/trashPhotos接口）
   - 实现清空回收站功能（调用/api/emptyTrash和/api/getProgress接口，显示进度）
   - _需求：6.1、6.2、6.3、6.4、6.5、6.6、6.7、6.8、6.9_

---

## 第五阶段：主导航和底部导航栏（P0 - MVP完善）

- [ ] 10. 实现主界面导航架构
   - 创建MainActivity和底部导航栏（Photos、Albums、Settings）
   - 实现Navigation Compose导航管理
   - 实现各主要页面的路由配置
   - 实现深色模式支持和主题切换
   - _需求：设计参考-UI/UX设计原则_

---

## 第六阶段：照片筛选和搜索（P1 - 核心功能）

- [ ] 11. 实现基础筛选功能
   - 创建FilterBottomSheet UI（筛选选项面板）
   - 实现收藏筛选（star=true参数）
   - 实现视频筛选（video=true参数）
   - 实现筛选条件的状态管理和应用
   - _需求：3.1、3.2、3.3、3.8、3.9_

- [ ] 12. 实现高级筛选功能
   - 实现日期树筛选（调用/api/getPicsDate接口，显示年月活动树）
   - 实现文件夹树筛选（调用/api/getFoldersData接口）
   - 实现标签筛选（调用/api/getAllTags接口）
   - 实现人脸筛选（调用/api/getFacesWithName接口）
   - _需求：3.4、3.5、3.6、3.7_

---

## 第七阶段：照片上传功能（P1 - 核心功能）

- [ ] 13. 实现照片选择和上传
   - 实现照片选择器（使用ActivityResultContract选择多张照片）
   - 创建UploadScreen UI（待上传列表、进度显示）
   - 实现UploadViewModel（管理上传队列）
   - 实现照片上传（调用/api/uploadPhoto接口，multipart/form-data）
   - 实现上传进度显示（单张和整体进度）
   - 实现上传失败重试和取消功能
   - _需求：5.1、5.2、5.3、5.4、5.5、5.6、5.7、5.9_

- [ ] 14. 实现后台上传和通知
   - 实现后台上传服务（WorkManager）
   - 实现通知栏进度显示
   - 实现网络断开暂停和恢复逻辑
   - 请求必要的权限（存储、通知、后台运行）
   - _需求：5.8、5.10、15.1、15.5、15.6_

---

## 第八阶段：活动管理（P1 - 核心功能）

- [ ] 15. 实现活动列表和详情
   - 创建ActivitiesScreen UI（卡片式布局）
   - 实现ActivityViewModel（加载活动列表）
   - 实现ActivityRepository（调用/api/getActivities接口）
   - 实现点击活动跳转到照片筛选页
   - _需求：7.1、7.2、7.3_

- [ ] 16. 实现活动创建和编辑
   - 创建ActivityEditDialog UI（表单输入）
   - 实现活动创建功能（调用/api/createOrUpdateActivity接口）
   - 实现活动编辑功能（预填充数据、更新）
   - 实现活动删除功能（调用/api/deleteActivity接口）
   - 实现照片关联活动功能
   - _需求：7.4、7.5、7.6、7.7、7.8、7.9、7.10、4.10、4.11_

---

## 第九阶段：相册视图（P1 - 核心功能）

- [ ] 17. 实现按日期浏览相册
   - 创建AlbumsScreen UI（日期树展示）
   - 实现AlbumsViewModel（加载日期树结构）
   - 调用/api/getPicsDate接口获取数据
   - 实现年月活动的展开折叠
   - 实现点击时间节点跳转到照片筛选页
   - 实现下拉刷新和筛选选项
   - _需求：11.1、11.2、11.3、11.4、11.5、11.6、11.7_

---

## 第十阶段：人脸识别管理（P2 - 高级功能）

- [ ] 18. 实现人脸列表和基础操作
   - 创建FacesScreen UI（网格布局显示人脸）
   - 实现FacesViewModel（分页加载人脸列表）
   - 调用/api/getFaces接口和/get_face_img接口
   - 实现点击人脸跳转到照片筛选页
   - 实现人脸命名功能（调用/api/updateFace接口）
   - 实现人脸隐藏和收藏功能
   - _需求：8.1、8.2、8.3、8.4、8.5、8.6、8.7、8.8_

- [ ] 19. 实现人脸高级操作
   - 实现人脸合并功能（调用/api/mergeFace接口）
   - 实现照片详情页人脸框显示（调用/api/getFacesForPhoto接口）
   - 实现人脸信息删除（调用/api/removePhotoFaceInfo接口）
   - 实现重新扫描人脸（调用/api/rescanFace接口）
   - 实现人脸筛选和搜索功能
   - _需求：8.9、8.10、8.11、8.12、8.13、8.14、4.12_

---

## 第十一阶段：地图视图（P2 - 高级功能）

- [ ] 20. 实现地图照片展示
   - 集成地图SDK（Google Maps或高德地图）
   - 创建MapScreen UI（全屏地图）
   - 调用/geo_json_api/loadMarkersGeoJson接口加载位置数据
   - 实现照片位置标记和聚合显示
   - 实现点击标记显示照片缩略图
   - 实现定位功能和地图类型切换
   - 请求位置权限
   - _需求：9.1、9.2、9.3、9.4、9.5、9.6、9.7、9.8、15.3_

- [ ] 21. 实现地理位置编辑
   - 创建LocationPickerDialog UI（地图选择器）
   - 实现照片地理位置编辑（调用/api/updateImage接口）
   - 实现自动获取地址功能
   - _需求：4.4、4.5_

---

## 第十二阶段：文件夹管理（P2 - 高级功能）

- [ ] 22. 实现文件夹浏览和操作
   - 创建FoldersScreen UI（树形结构展示）
   - 实现FoldersViewModel（加载文件夹树）
   - 调用/api/getFoldersData接口
   - 实现文件夹展开折叠和点击筛选
   - 实现文件夹移动（调用/api/moveFolder接口）
   - 实现文件夹删除（调用/api/switchTrashFolder接口）
   - _需求：10.1、10.2、10.3、10.4、10.5、10.6、10.7、10.8_

- [ ] 23. 实现文件夹批量操作
   - 实现批量修改日期（调用/api/updateFolderDate接口）
   - 实现批量修改位置（调用/api/updateFolderGis接口）
   - 显示批量操作进度
   - _需求：10.9、10.10、10.11、10.12_

---

## 第十三阶段：应用设置和配置（P3 - 优化完善）

- [ ] 24. 实现应用设置页面
   - 创建SettingsScreen UI（分组列表布局）
   - 实现服务器地址配置
   - 实现图片质量配置（原图、高质量、标准）
   - 实现主题模式配置（跟随系统、浅色、深色）
   - 实现上传设置（仅WiFi、移动网络）
   - 实现通知设置开关
   - 显示应用版本和开源许可信息
   - _需求：12.1、12.2、12.3、12.6、12.7、12.8、12.9、12.10_

- [ ] 25. 实现缓存管理
   - 实现缓存大小统计
   - 实现清除缓存功能（显示释放空间）
   - 实现缓存策略配置
   - 实现LRU缓存清理策略
   - _需求：12.4、12.5、13.5、13.6_

---

## 第十四阶段：性能优化和用户体验（P3 - 优化完善）

- [ ] 26. 实现性能优化
   - 优化应用启动速度（延迟初始化、启动页）
   - 实现照片列表虚拟滚动和懒加载
   - 实现渐进式图片加载（模糊缩略图→高清图）
   - 实现乐观更新和失败回滚机制
   - 实现内存管理和自动缓存清理
   - 实现长时间操作防止屏幕休眠
   - _需求：14.1、14.2、14.3、14.4、14.5、14.6、14.7、14.8_

- [ ] 27. 实现离线支持和错误处理
   - 实现离线状态检测和提示
   - 实现网络恢复自动重试
   - 实现友好的错误提示和日志记录
   - 实现弱网环境加载状态和重试选项
   - _需求：13.1、13.2、13.3、13.4、14.9、14.10_

---

## 第十五阶段：权限管理和安全（P3 - 优化完善）

- [ ] 28. 完善权限管理
   - 实现运行时权限请求（存储、相机、位置、通知）
   - 实现权限拒绝后的引导对话框
   - 实现权限撤销后的功能禁用和提示
   - 实现相机拍照上传功能（请求相机权限）
   - _需求：15.1、15.2、15.3、15.4、15.7_

- [ ] 29. 实现安全增强功能
   - 实现应用锁（生物识别/PIN码）
   - 确保HTTPS通信
   - 确保敏感信息不记录到日志
   - 进行安全性测试和代码审查
   - _需求：非功能性需求-安全性_

---

## 第十六阶段：测试和发布准备（P3 - 最终完善）

- [ ] 30. 编写测试和文档
   - 编写关键功能的单元测试（ViewModel、Repository）
   - 编写UI测试（关键流程）
   - 编写用户使用文档和README
   - 进行性能测试和优化（启动时间、内存占用、帧率）
   - 进行兼容性测试（不同Android版本、屏幕尺寸）
   - _需求：非功能性需求-性能、兼容性、可维护性_

---

*任务清单版本: v1.0*  
*创建日期: 2025-12-19*  
*预计总任务数: 30项*