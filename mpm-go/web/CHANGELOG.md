# 更新日志

## v1.3.0 - 2025-12-10

### ✨ 优化：操作菜单收起

优化照片操作按钮的交互设计，防止误触，提升用户体验。

#### 🎯 核心改进

**1. 收起操作按钮**
- ✅ 将"收藏"和"删除"按钮收起到"更多操作"菜单
- ✅ 右上角显示圆形菜单按钮（三个点图标）
- ✅ 只有鼠标悬停时才显示菜单按钮
- ✅ 点击菜单按钮展开下拉菜单

**2. 新增收藏标记**
- ✅ 已收藏的照片左上角显示黄色星星小标记
- ✅ 一眼识别收藏状态
- ✅ 不占用主要操作区域

**3. 防误触设计**
- ✅ 默认隐藏操作按钮
- ✅ 需要主动悬停才显示
- ✅ 需要点击菜单才能操作
- ✅ 两步操作，降低误触概率

#### 🎨 视觉设计

**菜单按钮**
- 半透明白色背景（95% 透明度）
- 毛玻璃效果（backdrop-filter: blur）
- 圆形按钮设计
- 悬停时变为纯白色

**收藏标记**
- 位置：左上角
- 图标：黄色实心星星
- 大小：16px
- 背景：白色圆形

**下拉菜单**
- 最小宽度：120px
- 位置：右下对齐
- 图标 + 文字
- 删除选项使用红色主题

#### 💡 交互流程

**之前（容易误触）：**
```
悬停照片 → 显示按钮覆盖层 → 容易误点
```

**现在（防误触）：**
```
1. 悬停照片 → 右上角显示菜单按钮
2. 点击菜单按钮 → 展开下拉菜单
3. 点击具体操作 → 执行操作
```

#### 🔧 技术实现

**菜单结构**
```vue
<t-dropdown trigger="click" placement="bottom-right">
  <t-button shape="circle" class="menu-trigger">
    <t-icon name="ellipsis" />
  </t-button>
  
  <t-dropdown-menu>
    <t-dropdown-item @click="toggleStar(photo)">
      <template #prefix-icon>
        <t-icon name="star" />
      </template>
      收藏/取消收藏
    </t-dropdown-item>
    
    <t-dropdown-item theme="error" @click="trashPhoto(photo)">
      <template #prefix-icon>
        <t-icon name="delete" />
      </template>
      删除
    </t-dropdown-item>
  </t-dropdown-menu>
</t-dropdown>
```

**样式要点**
```css
.action-menu {
  opacity: 0;  /* 默认隐藏 */
  transition: opacity 0.2s;
}

.photo-wrapper:hover .action-menu {
  opacity: 1;  /* 悬停显示 */
}

/* 有选中标记时，菜单按钮向左移动避免重叠 */
.photo-selected .action-menu {
  right: 40px;
}
```

#### 📊 对比

| 特性 | 之前 | 现在 |
|------|------|------|
| 操作步骤 | 1步（直接点击） | 2步（菜单 → 操作） |
| 误触概率 | 高 | 低 |
| 收藏识别 | 需要悬停查看 | 直接显示星标 |
| 视觉干扰 | 悬停有覆盖层 | 只有小按钮 |
| 操作安全性 | 低 | 高 |

#### 🎯 用户体验

**照片列表：**
- 浏览照片时不会有操作按钮干扰
- 收藏的照片一眼可识别（黄色星星）
- 需要操作时，悬停显示菜单按钮
- 点击菜单选择具体操作

**回收站：**
- 同样使用菜单方式
- 只有"恢复"一个操作
- 防止误触恢复

#### 🐛 已修复

- 菜单按钮与选中标记重叠问题（自动向左移动）
- 菜单按钮的 z-index 层级
- 点击菜单按钮不触发照片选择
- 遮罩层透明度优化（降低干扰）

---

## v1.2.0 - 2025-12-10

### ✨ 新功能：照片多选

实现了照片多选功能，支持 Shift 连续选择和 Ctrl 单独选择。

#### 🎯 核心特性

**1. 三种选择方式**
- ✅ **普通点击**：切换当前照片的选中状态
- ✅ **Ctrl/Cmd + 点击**：单独选择或取消选择照片（不影响其他照片）
- ✅ **Shift + 点击**：连续选择从上次选中到当前照片之间的所有照片

**2. 视觉反馈**
- ✅ 选中的照片有蓝色边框高亮
- ✅ 右上角显示蓝色勾选图标
- ✅ 缩放效果区分选中状态
- ✅ 顶部显示已选择数量

**3. 选择管理**
- ✅ 显示"已选择 X 张"
- ✅ 一键清除所有选择
- ✅ 切换过滤条件自动清除选择

#### 🔧 技术实现

**状态管理**
```typescript
// 使用 Set 存储选中的照片 ID
const selectedPhotos = ref<Set<number>>(new Set())

// 记录最后选中的索引（用于 Shift 连续选择）
const lastSelectedIndex = ref<number>(-1)
```

**点击事件处理**
```typescript
handlePhotoClick(photo, event) {
  if (event.ctrlKey || event.metaKey) {
    // Ctrl/Cmd: 单独切换
    toggleSelection(photo)
  } else if (event.shiftKey && lastSelectedIndex >= 0) {
    // Shift: 连续选择
    selectRange(photo)
  } else {
    // 普通点击: 切换选择
    toggleSelection(photo)
  }
}
```

**连续选择算法**
```typescript
selectRange(photo) {
  // 1. 获取所有照片（按顺序）
  const allPhotos = getAllPhotosInOrder()
  
  // 2. 找到起始和结束索引
  const start = Math.min(lastSelectedIndex, currentIndex)
  const end = Math.max(lastSelectedIndex, currentIndex)
  
  // 3. 选中范围内的所有照片
  for (let i = start; i <= end; i++) {
    selectedPhotos.add(allPhotos[i].id)
  }
}
```

#### 🎨 用户体验

**照片列表 (Photos.vue)**
1. 点击照片 → 选中（显示蓝色边框和勾选图标）
2. 再次点击 → 取消选中
3. Ctrl + 点击多张照片 → 单独选择
4. 点击第一张，Shift + 点击第五张 → 选中 1-5 张
5. 顶部显示"已选择 X 张"
6. 点击"清除选择"清空

**回收站 (Trash.vue)**
- 同样支持多选功能
- 可以配合批量操作使用

**行为说明**
- 在照片列表中，首次点击会选中照片（不打开预览）
- 只有当没有选中任何照片时，点击才会打开预览
- 在回收站中，所有点击都是选择操作

#### 💡 使用场景

**适合：**
- ✅ 批量收藏照片
- ✅ 批量删除照片
- ✅ 批量下载照片（待实现）
- ✅ 批量添加标签（待实现）
- ✅ 批量移动相册（待实现）

**操作技巧：**
```
场景1：选择相邻的照片
  1. 点击第一张照片
  2. Shift + 点击最后一张
  ✅ 中间所有照片都被选中

场景2：选择不相邻的照片
  1. 点击第一张
  2. Ctrl + 点击第三张
  3. Ctrl + 点击第五张
  ✅ 只选中了 1、3、5 张

场景3：取消某个选中
  1. 已选中多张照片
  2. Ctrl + 点击其中一张
  ✅ 取消该照片的选中状态

场景4：清空所有选择
  点击顶部的"清除选择"按钮
  ✅ 所有照片取消选中
```

#### 🎯 视觉设计

**选中状态样式**
- 蓝色边框：`box-shadow: 0 0 0 3px var(--td-brand-color)`
- 缩放效果：`transform: scale(0.95)`
- 勾选图标：右上角白色圆形背景
- 颜色主题：使用 TDesign 品牌色

**交互效果**
- 选中时有缩放动画
- 鼠标悬停时上移效果
- 流畅的过渡动画：`transition: all 0.2s`

#### 🐛 已修复

- 切换过滤条件时清除选择状态
- 虚拟滚动时正确维护选择状态
- Shift 选择时正确处理缓存中的照片顺序
- 选择信息实时更新

#### 🔜 后续规划

- [ ] 批量下载选中的照片
- [ ] 批量添加/修改标签
- [ ] 批量移动到相册
- [ ] 全选/反选功能
- [ ] 批量收藏/取消收藏

---

## v1.1.0 - 2025-12-10

### ✨ 新功能：虚拟滚动

实现了真正的虚拟滚动功能，支持直接拖动滚动条到任意位置浏览照片。

#### 🎯 核心特性

**1. 自由滚动**
- ✅ 滚动条可以拖动到任意位置
- ✅ 根据滚动位置按需加载照片
- ✅ 智能缓存机制，避免重复加载
- ✅ 平滑流畅的滚动体验

**2. 虚拟渲染**
- ✅ 只渲染可视区域内的照片
- ✅ 自动计算可见范围
- ✅ 添加缓冲区（前后各3行）
- ✅ 动态高度计算

**3. 性能优化**
- ✅ 分页缓存（每次100张照片）
- ✅ 并行加载多个分页
- ✅ 最小化 DOM 节点数量
- ✅ 懒加载图片

#### 🔧 技术实现

**虚拟滚动原理**
```typescript
// 1. 创建虚拟占位空间（总高度）
totalHeight = 总行数 × 行高

// 2. 计算可见范围
可见起始行 = 滚动位置 ÷ 行高
可见结束行 = (滚动位置 + 容器高度) ÷ 行高

// 3. 只渲染可见范围内的照片
可见照片 = 从缓存中提取 [起始索引, 结束索引]

// 4. 使用 transform 定位
offsetY = 可见起始行 × 行高
```

**分页缓存策略**
- 每次请求 100 张照片
- 缓存以 start 为 key
- 根据可见范围自动加载缺失的分页
- 并行请求多个分页

**自适应布局**
- 根据容器宽度自动计算每行显示数量
- 窗口大小改变时重新计算
- 响应式调整布局

#### 📊 性能对比

| 特性 | 传统分页 | 顺序滚动 | 虚拟滚动 |
|------|---------|---------|---------|
| 初始加载 | 50张 | 50张 | 按需 |
| DOM节点 | 固定50个 | 累积增加 | 固定~150个 |
| 内存占用 | 低 | 逐渐增加 | 恒定 |
| 跳转任意位置 | ❌ | ❌ | ✅ |
| 滚动流畅度 | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 大数据支持 | ❌ | ❌ | ✅ |

#### 🎨 用户体验

**照片列表 (Photos.vue)**
1. 打开页面，自动加载可见区域的照片
2. 随意拖动滚动条到任何位置
3. 自动加载对应位置的照片
4. 向上/向下滚动都流畅加载
5. 切换过滤条件后重置滚动位置

**回收站 (Trash.vue)**
- 同样支持虚拟滚动
- 恢复照片后智能刷新
- 清空回收站后重置

#### 💡 使用场景

**适合：**
- ✅ 大量照片（1000+ 张）
- ✅ 需要快速定位到某个位置
- ✅ 频繁上下滚动浏览
- ✅ 低内存设备

**配置参数：**
```typescript
const itemHeight = 280  // 照片项高度
const itemsPerRow = 5   // 每行数量（自动计算）
const bufferSize = 3    // 缓冲行数
const pageSize = 100    // 每次加载数量
```

#### 🐛 已修复

- 切换过滤条件时清空缓存
- 删除/恢复照片后正确更新
- 窗口大小改变时重新计算布局
- 滚动到边界时的正确处理

---

## v1.0.0 - 2025-12-10 (之前版本)

### ✨ 初始版本：顺序无限滚动

实现了基本的无限滚动功能，向下滚动自动加载更多。

#### 特点
- 向下滚动自动加载
- 距离底部 200px 时触发
- 按顺序累积加载照片
- 显示"已加载 X / 总数"

#### 限制
- ❌ 不能跳转到任意位置
- ❌ 必须按顺序滚动
- ❌ DOM 节点累积增加
- ❌ 大数据量性能下降
